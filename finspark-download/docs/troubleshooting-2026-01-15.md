# æœåŠ¡å™¨å¯åŠ¨é—®é¢˜æ’æŸ¥ä¸è§£å†³æ–¹æ¡ˆ

**æ—¥æœŸ**: 2026-01-15  
**é—®é¢˜**: è‚¡ç¥¨åˆ†æé¢æ¿æœåŠ¡å™¨ä¸¤æ¬¡æœªèƒ½æˆåŠŸå¯åŠ¨  
**å½±å“**: ç”¨æˆ·æ— æ³•è®¿é—®æµ‹è¯•ç¯å¢ƒ

## é—®é¢˜è¯Šæ–­

### 1. é—®é¢˜ç°è±¡
- æµ‹è¯•ç¯å¢ƒæ— æ³•è®¿é—®
- 3000ç«¯å£æ²¡æœ‰æœåŠ¡ç›‘å¬
- PM2è¿›ç¨‹åˆ—è¡¨ä¸ºç©º

### 2. æ ¹æœ¬åŸå› åˆ†æ

#### åŸå›  1: PM2å®ˆæŠ¤è¿›ç¨‹é‡å¯
```
PM2        | 2026-01-15T17:12:06: PM2 log: --- New PM2 Daemon started
```
**åˆ†æ**: PM2å®ˆæŠ¤è¿›ç¨‹åœ¨15:11:28åœæ­¢æœåŠ¡åï¼Œåˆ°17:12:06æ‰é‡æ–°å¯åŠ¨ï¼Œä½†æ²¡æœ‰è‡ªåŠ¨æ¢å¤åº”ç”¨è¿›ç¨‹ã€‚

#### åŸå›  2: åº”ç”¨è¿›ç¨‹æœªè‡ªåŠ¨å¯åŠ¨
- PM2å®ˆæŠ¤è¿›ç¨‹é‡å¯åï¼Œä¹‹å‰è¿è¡Œçš„`finspark`åº”ç”¨æ²¡æœ‰è‡ªåŠ¨æ¢å¤
- è¿™å¯èƒ½æ˜¯å› ä¸ºæ²¡æœ‰ä½¿ç”¨`pm2 save`å‘½ä»¤ä¿å­˜è¿›ç¨‹çŠ¶æ€

#### åŸå›  3: æ„å»ºäº§ç‰©å­˜åœ¨ä½†æœåŠ¡æœªè¿è¡Œ
- `dist/`ç›®å½•å­˜åœ¨ä¸”åŒ…å«æœ€æ–°æ„å»ºæ–‡ä»¶ï¼ˆ_worker.jsï¼‰
- æ•°æ®åº“æ–‡ä»¶æ­£å¸¸ï¼ˆ.wrangler/state/v3/d1ï¼‰
- ä½†Wrangler dev serveræ²¡æœ‰è¿è¡Œ

### 3. ä»£ç å±‚é¢æ£€æŸ¥

#### PinyinæœåŠ¡è­¦å‘Šï¼ˆéé˜»å¡æ€§ï¼‰
```
[plugin vite:esbuild] src/services/pinyin.ts: Duplicate key "å­" in object literal
[plugin vite:esbuild] src/services/pinyin.ts: Duplicate key "å‚¨" in object literal
[plugin vite:esbuild] src/services/pinyin.ts: Duplicate key "åˆ¶" in object literal
[plugin vite:esbuild] src/services/pinyin.ts: Duplicate key "å…‰" in object literal
[plugin vite:esbuild] src/services/pinyin.ts: Duplicate key "æ´‹" in object literal
```

**åˆ†æ**: 
- è¿™äº›æ˜¯ç¼–è¯‘æ—¶è­¦å‘Šï¼Œä¸æ˜¯é”™è¯¯
- å¯¹è±¡å­—é¢é‡ä¸­æœ‰é‡å¤çš„é”®ï¼Œä¼šè¢«åé¢çš„å€¼è¦†ç›–
- **ä¸å½±å“æœåŠ¡å¯åŠ¨å’Œè¿è¡Œ**
- å¯ä»¥åœ¨åç»­ä¼˜åŒ–ä¸­ä¿®å¤ï¼ˆåˆ é™¤é‡å¤é”®ï¼‰

## è§£å†³æ–¹æ¡ˆ

### ç«‹å³æ‰§è¡Œçš„ä¿®å¤æ­¥éª¤

1. **é‡æ–°æ„å»ºé¡¹ç›®**
```bash
cd /home/user/webapp && npm run build
```
ç»“æœ: âœ… æ„å»ºæˆåŠŸï¼ˆ2.09sï¼‰

2. **å¯åŠ¨PM2æœåŠ¡**
```bash
cd /home/user/webapp && pm2 start ecosystem.config.cjs
```
ç»“æœ: âœ… æœåŠ¡æˆåŠŸå¯åŠ¨ï¼ˆPID: 2031ï¼‰

3. **éªŒè¯æœåŠ¡çŠ¶æ€**
```bash
# PM2çŠ¶æ€æ£€æŸ¥
pm2 status
# è¾“å‡º: finspark | online | uptime: 41s | cpu: 0% | mem: 65.4mb

# ç«¯å£ç›‘å¬æ£€æŸ¥
netstat -tuln | grep 3000
# è¾“å‡º: tcp 0.0.0.0:3000 LISTEN

# å¥åº·æ£€æŸ¥
curl https://3000-ibkkiwxzgdsok7jesa2f2-5634da27.sandbox.novita.ai/api/health
# è¾“å‡º: {"status":"ok","timestamp":"2026-01-15T17:13:06.000Z","database":"ready","stockCount":169}
```

### é¢„é˜²æªæ–½

#### 1. PM2æŒä¹…åŒ–é…ç½®
**å»ºè®®**: ä½¿ç”¨`pm2 save`ä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨ï¼Œç¡®ä¿PM2å®ˆæŠ¤è¿›ç¨‹é‡å¯åè‡ªåŠ¨æ¢å¤åº”ç”¨

```bash
# ä¿å­˜å½“å‰è¿›ç¨‹çŠ¶æ€
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ï¼ˆå¯é€‰ï¼‰
pm2 startup
```

#### 2. å¥åº·æ£€æŸ¥ç›‘æ§
**å»ºè®®**: æ·»åŠ å®šæ—¶å¥åº·æ£€æŸ¥è„šæœ¬

```bash
# åˆ›å»ºå¥åº·æ£€æŸ¥è„šæœ¬
cat > /home/user/webapp/scripts/health-check.sh << 'EOF'
#!/bin/bash
HEALTH_URL="http://localhost:3000/api/health"
if ! curl -sf "$HEALTH_URL" > /dev/null; then
    echo "[$(date)] Service unhealthy, restarting PM2..."
    cd /home/user/webapp && pm2 restart finspark
fi
EOF

chmod +x /home/user/webapp/scripts/health-check.sh

# æ·»åŠ åˆ°crontabï¼ˆæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
# */5 * * * * /home/user/webapp/scripts/health-check.sh
```

#### 3. ä»£ç ä¼˜åŒ–å»ºè®®

**ä¿®å¤Pinyiné‡å¤é”®é—®é¢˜**
- æ–‡ä»¶: `src/services/pinyin.ts`
- ä½ç½®: ç¬¬82-94è¡Œ
- æ“ä½œ: ç§»é™¤å¯¹è±¡å­—é¢é‡ä¸­çš„é‡å¤é”®
- ä¼˜å…ˆçº§: ä½ï¼ˆä¸å½±å“åŠŸèƒ½ï¼Œä»…ä¸ºä»£ç è´¨é‡ä¼˜åŒ–ï¼‰

#### 4. æ„å»ºæµç¨‹ä¼˜åŒ–

**å½“å‰æµç¨‹**:
```bash
npm run build  # æ‰‹åŠ¨æ„å»º
pm2 start      # æ‰‹åŠ¨å¯åŠ¨
```

**å»ºè®®æµç¨‹**:
```bash
npm run start  # ä¸€é”®æ„å»º+åˆå§‹åŒ–+å¯åŠ¨
```

è¯¥å‘½ä»¤å·²åœ¨package.jsonä¸­å®šä¹‰:
```json
"start": "npm run build && npm run db:init && npm run dev:sandbox"
```

## æœåŠ¡æ¢å¤çŠ¶æ€

### âœ… å½“å‰è¿è¡ŒçŠ¶æ€
| æŒ‡æ ‡ | çŠ¶æ€ | è¯¦æƒ… |
|------|------|------|
| WebæœåŠ¡ | âœ… æ­£å¸¸ | PM2å®ˆæŠ¤ï¼ŒPID: 2031 |
| ç«¯å£ç›‘å¬ | âœ… æ­£å¸¸ | 0.0.0.0:3000 |
| D1æ•°æ®åº“ | âœ… æ­£å¸¸ | 169æ¡è‚¡ç¥¨æ•°æ® |
| APIå¥åº·æ£€æŸ¥ | âœ… æ­£å¸¸ | /api/health è¿”å› ok |
| çƒ­é—¨è‚¡ç¥¨æ¥å£ | âœ… æ­£å¸¸ | /api/stock/hot è¿”å›æ•°æ® |
| æ•°æ®åº“çŠ¶æ€æ¥å£ | âœ… æ­£å¸¸ | /api/db/status è¿”å›ç»Ÿè®¡ä¿¡æ¯ |

### ğŸŒ æ–°çš„æµ‹è¯•åœ°å€
- **ä¸»URL**: https://3000-ibkkiwxzgdsok7jesa2f2-5634da27.sandbox.novita.ai
- **å¥åº·æ£€æŸ¥**: https://3000-ibkkiwxzgdsok7jesa2f2-5634da27.sandbox.novita.ai/api/health
- **çƒ­é—¨è‚¡ç¥¨**: https://3000-ibkkiwxzgdsok7jesa2f2-5634da27.sandbox.novita.ai/api/stock/hot
- **æ•°æ®åº“çŠ¶æ€**: https://3000-ibkkiwxzgdsok7jesa2f2-5634da27.sandbox.novita.ai/api/db/status

### ğŸ“Š æœ€æ–°åŠŸèƒ½éªŒè¯

#### è‚¡ç¥¨èµ°åŠ¿é¢æ¿ï¼ˆæœ€æ–°å¼€å‘ï¼‰
- **æäº¤è®°å½•**: `8dc00a0 fix(stock-panel): ä¿®æ­£æˆäº¤é¢å•ä½è®¡ç®—`
- **åŠŸèƒ½**: ä¼ä¸šåˆ†æé¡µæ˜¾ç¤ºè‚¡ç¥¨èµ°åŠ¿å’Œæˆäº¤æ•°æ®
- **ä¿®å¤**: Tushare amountå•ä½ä»åƒå…ƒæ­£ç¡®è½¬æ¢ä¸ºäº¿å…ƒ
- **çŠ¶æ€**: âœ… å·²åŒ…å«åœ¨å½“å‰éƒ¨ç½²ä¸­

#### å…¶ä»–æœ€è¿‘æ›´æ–°
- `bc5db7c`: å®ç°ä¼ä¸šåˆ†æé¡µè‚¡ç¥¨èµ°åŠ¿é¢æ¿
- `8f6f2a8`: ä¿®å¤è¡Œä¸šå¯¹æ¯”AIæ·±åº¦åˆ†æä¸ºç©ºçš„é—®é¢˜
- `b1e2191`: ä¿®å¤åˆ†æé¡µæ¼«ç”»ç”ŸæˆæŒ‰é’®æ— å“åº”é—®é¢˜

## æ€»ç»“

### é—®é¢˜æ€»ç»“
1. **ä¸»è¦é—®é¢˜**: PM2å®ˆæŠ¤è¿›ç¨‹é‡å¯ååº”ç”¨æœªè‡ªåŠ¨æ¢å¤
2. **æ¬¡è¦é—®é¢˜**: PinyinæœåŠ¡ä»£ç è´¨é‡è­¦å‘Šï¼ˆä¸å½±å“è¿è¡Œï¼‰
3. **å½±å“èŒƒå›´**: æµ‹è¯•ç¯å¢ƒä¸å¯è®¿é—®

### è§£å†³ç»“æœ
- âœ… æœåŠ¡å·²æˆåŠŸé‡å¯
- âœ… æ‰€æœ‰APIæ¥å£æ­£å¸¸å“åº”
- âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
- âœ… æœ€æ–°è‚¡ç¥¨èµ°åŠ¿é¢æ¿åŠŸèƒ½å·²éƒ¨ç½²
- âœ… READMEæ–‡æ¡£å·²æ›´æ–°æœ€æ–°æµ‹è¯•åœ°å€

### å»ºè®®åç»­æ“ä½œ
1. æ‰§è¡Œ`pm2 save`æŒä¹…åŒ–è¿›ç¨‹çŠ¶æ€
2. è€ƒè™‘æ·»åŠ è‡ªåŠ¨å¥åº·æ£€æŸ¥è„šæœ¬
3. å¯é€‰ï¼šä¿®å¤pinyin.tsä¸­çš„é‡å¤é”®è­¦å‘Š
4. ç›‘æ§æœåŠ¡ç¨³å®šæ€§24å°æ—¶

---
**ä¿®å¤äººå‘˜**: GenSpark AI Developer  
**ä¿®å¤æ—¶é—´**: 2026-01-15 17:13 UTC  
**éªŒè¯çŠ¶æ€**: âœ… é€šè¿‡å…¨éƒ¨æµ‹è¯•
